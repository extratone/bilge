/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

const ELEMENT_RE = /[\w-]+/g;
const ID_RE = /#[\w-]+/g;
const CLASS_RE = /\.[\w-]+/g;
const ATTR_RE = /\[[^\]]+\]/g;
const PSEUDO_CLASSES_RE = /\:(?!not)[\w-]+(\(.*\))?/g;
const PSEUDO_ELEMENTS_RE = /\:\:?(after|before|first-letter|first-line|selection)/g;
// convert an array-like object to array
function toArray(list) {
    return [].slice.call(list);
}
// handles extraction of `cssRules` as an `Array` from a stylesheet or something that behaves the same
function getSheetRules(stylesheet) {
    var sheet_media = stylesheet.media && stylesheet.media.mediaText;
    // if this sheet is disabled skip it
    if (stylesheet.disabled)
        return [];
    // if this sheet's media is specified and doesn't match the viewport then skip it
    if (sheet_media &&
        sheet_media.length &&
        !window.matchMedia(sheet_media).matches)
        return [];
    // get the style rules of this sheet
    return toArray(stylesheet.cssRules);
}
function _find(string, re) {
    var matches = string.match(re);
    return matches ? matches.length : 0;
}
// calculates the specificity of a given `selector`
function calculateScore(selector) {
    var score = [0, 0, 0], parts = selector.split(" "), part, match;
    //TODO: clean the ':not' part since the last ELEMENT_RE will pick it up
    while (((part = parts.shift()), typeof part == "string")) {
        // find all pseudo-elements
        match = _find(part, PSEUDO_ELEMENTS_RE);
        score[2] += match;
        // and remove them
        match && (part = part.replace(PSEUDO_ELEMENTS_RE, ""));
        // find all pseudo-classes
        match = _find(part, PSEUDO_CLASSES_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(PSEUDO_CLASSES_RE, ""));
        // find all attributes
        match = _find(part, ATTR_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(ATTR_RE, ""));
        // find all IDs
        match = _find(part, ID_RE);
        score[0] += match;
        // and remove them
        match && (part = part.replace(ID_RE, ""));
        // find all classes
        match = _find(part, CLASS_RE);
        score[1] += match;
        // and remove them
        match && (part = part.replace(CLASS_RE, ""));
        // find all elements
        score[2] += _find(part, ELEMENT_RE);
    }
    return parseInt(score.join(""), 10);
}
// returns the heights possible specificity score an element can get from a give rule's selectorText
function getSpecificityScore(element, selectorText) {
    var selectors = selectorText.split(","), selector, score, result = 0;
    while ((selector = selectors.shift())) {
        if (element.matches(selector)) {
            score = calculateScore(selector);
            result = score > result ? score : result;
        }
    }
    return result;
}
function sortBySpecificity(element, rules) {
    // comparing function that sorts CSSStyleRules according to specificity of their `selectorText`
    function compareSpecificity(a, b) {
        let aScore = getSpecificityScore(element, a.selectorText);
        let bScore = getSpecificityScore(element, b.selectorText);
        // If the styles come from app.css, they take a lower priority
        if (aScore === bScore) {
            if (a.parentStyleSheet.href)
                aScore -= 1;
            if (b.parentStyleSheet.href)
                bScore -= 1;
        }
        return (aScore -
            bScore);
    }
    return rules.sort(compareSpecificity);
}
function getMatchedCSSRules(element) {
    let styleSheets = toArray(window.document.styleSheets);
    let sheet;
    let rules;
    let rule;
    let result = [];
    // assuming the browser hands us stylesheets in order of appearance
    // we iterate them from the beginning to follow proper cascade order
    while ((sheet = styleSheets.shift())) {
        // get the style rules of this sheet
        rules = getSheetRules(sheet);
        // loop the rules in order of appearance
        while ((rule = rules.shift())) {
            // if this is an @import rule
            if (rule.styleSheet) {
                // insert the imported stylesheet's rules at the beginning of this stylesheet's rules
                rules = getSheetRules(rule.styleSheet).concat(rules);
                // and skip this rule
                continue;
            }
            // if there's no stylesheet attribute BUT there IS a media attribute it's a media rule
            else if (rule.media) {
                // insert the contained rules of this media rule to the beginning of this stylesheet's rules
                rules = getSheetRules(rule).concat(rules);
                // and skip it
                continue;
            }
            // check if this element matches this rule's selector
            if (element.matches(rule.selectorText)) {
                // push the rule to the results set
                result.push(rule);
            }
        }
    }
    // sort according to specificity
    return sortBySpecificity(element, result);
}

// Split CSS margin and padding values like `0 auto`, `10px auto 0`, etc.
function getRightLeft(val) {
    if (/\s/.test(val)) {
        const vals = val.split(/\s+/g);
        if (vals.length === 2 || vals.length === 3) {
            return [vals[1], vals[1]];
        }
        if (vals.length === 4) {
            return [vals[1], vals[3]];
        }
    }
    return [val, val];
}
const keyMap = {
    width: "width",
    maxWidth: "max-width",
    margin: "margin",
    marginLeft: "margin-left",
    marginRight: "margin-right",
    padding: "padding",
    paddingLeft: "padding-left",
    paddingRight: "padding-right",
};
// Get the relevant style values from a reference element
function getRefSizing(el) {
    const rules = getMatchedCSSRules(el);
    const sizing = {};
    rules.forEach((r) => {
        const { width, maxWidth, margin, marginLeft, marginRight, padding, paddingLeft, paddingRight, } = r.style;
        if (width) {
            sizing.width = width;
        }
        if (maxWidth) {
            sizing.maxWidth = maxWidth;
        }
        if (margin) {
            const [mRight, mLeft] = getRightLeft(margin);
            sizing.marginLeft = mLeft;
            sizing.marginLeft = mRight;
        }
        if (marginLeft)
            sizing.marginLeft = marginLeft;
        if (marginRight)
            sizing.marginRight = marginRight;
        if (padding) {
            const [pRight, pLeft] = getRightLeft(padding);
            sizing.paddingLeft = pLeft;
            sizing.paddingLeft = pRight;
        }
        if (paddingLeft)
            sizing.paddingLeft = paddingLeft;
        if (paddingRight)
            sizing.paddingRight = paddingRight;
    });
    return sizing;
}
// Apply reference styles to a heading element
function applyRefStyles(heading, ref) {
    for (const key in ref) {
        const val = ref[key];
        if (val) {
            heading.style.setProperty(keyMap[key], val);
        }
    }
}
class HeadingsManager {
    constructor() {
        this.headings = {};
        this.previewSizerRef = null;
        this.codeMirrorSizerRef = null;
        this.codeMirrorSizerInvalid = true;
    }
    getPreviewSizerStyles() {
        const el = document.getElementsByClassName("markdown-preview-sizer");
        if (el.length) {
            this.previewSizerRef = getRefSizing(el[0]);
        }
    }
    getCodeMirrorSizerStyles() {
        const sizerEl = document.getElementsByClassName("CodeMirror-sizer");
        const lineEl = document.getElementsByClassName("CodeMirror-line");
        if (sizerEl.length && lineEl.length) {
            const sizer = sizerEl[0];
            const { marginLeft, paddingRight, borderRightWidth } = sizer.style;
            // If codemirror hasn't applied styles to the div yet, let's consider it
            // invalid so we can check it again later
            if (marginLeft !== "0px" && paddingRight !== "0px") {
                this.codeMirrorSizerInvalid = false;
            }
            const inline = {
                marginLeft,
                marginRight: borderRightWidth,
                paddingRight,
            };
            const sizerRef = getRefSizing(sizer);
            const line = lineEl[0];
            const lineRef = getRefSizing(line);
            // Combine inline styles with CSS styles
            this.codeMirrorSizerRef = Object.assign(Object.assign({}, inline), sizerRef);
            if (lineRef.paddingLeft) {
                this.codeMirrorSizerRef.paddingLeft = this.codeMirrorSizerRef
                    .paddingLeft
                    ? `calc(${this.codeMirrorSizerRef.paddingLeft} + ${lineRef.paddingLeft})`
                    : lineRef.paddingLeft;
            }
            if (lineRef.paddingRight) {
                this.codeMirrorSizerRef.paddingRight = this.codeMirrorSizerRef
                    .paddingRight
                    ? `calc(${this.codeMirrorSizerRef.paddingRight} + ${lineRef.paddingRight})`
                    : lineRef.paddingRight;
            }
        }
    }
    // Once the codemirror heading styles have been validated, loop through and update everything
    updateCodeMirrorHeadings() {
        Object.keys(this.headings).forEach((id) => {
            const h1Edit = document.getElementById(`${id}-edit`);
            applyRefStyles(h1Edit, this.codeMirrorSizerRef);
        });
    }
    // Clean up headings once a pane has been closed or the plugin has been disabled
    removeHeading(id) {
        if (!this.headings[id])
            return;
        const h1Edit = document.getElementById(`${id}-edit`);
        const h1Preview = document.getElementById(`${id}-preview`);
        if (h1Edit)
            h1Edit.remove();
        if (h1Preview)
            h1Preview.remove();
        this.headings[id].resizeWatcher.disconnect();
        delete this.headings[id].resizeWatcher;
        delete this.headings[id];
    }
    createHeading(id, leaf) {
        var _a, _b;
        // CodeMirror adds margin and padding only after the editor is visible
        if (this.codeMirrorSizerInvalid &&
            ((_a = leaf.getViewState().state) === null || _a === void 0 ? void 0 : _a.mode) === "source") {
            this.getCodeMirrorSizerStyles();
            if (!this.codeMirrorSizerInvalid) {
                this.updateCodeMirrorHeadings();
            }
        }
        if (this.headings[id])
            return;
        const title = (_b = leaf.view.file) === null || _b === void 0 ? void 0 : _b.basename;
        if (!title)
            return;
        const viewContent = leaf.view.containerEl.getElementsByClassName("CodeMirror-scroll");
        const lines = leaf.view.containerEl.getElementsByClassName("CodeMirror-lines");
        const previewContent = leaf.view.containerEl.getElementsByClassName("markdown-preview-view");
        if (!this.previewSizerRef) {
            this.getPreviewSizerStyles();
        }
        if (!this.codeMirrorSizerRef) {
            this.getCodeMirrorSizerStyles();
        }
        if (viewContent.length && previewContent.length) {
            // Create the codemirror heading
            const editEl = viewContent[0];
            const h1Edit = document.createElement("h1");
            applyRefStyles(h1Edit, this.codeMirrorSizerRef);
            h1Edit.setText(title);
            h1Edit.id = `${id}-edit`;
            h1Edit.classList.add('embedded-note-title', 'embedded-note-title__edit');
            editEl.prepend(h1Edit);
            const onResize = obsidian.debounce((entries) => {
                if (lines.length) {
                    const linesEl = lines[0];
                    const height = Math.ceil(entries[0].borderBoxSize[0].blockSize);
                    linesEl.style.paddingTop = `${height}px`;
                    h1Edit.style.marginBottom = `-${height}px`;
                }
            }, 20, true);
            // We need to push the content down when the pane resizes so the heading
            // doesn't cover the content
            const resizeWatcher = new window.ResizeObserver(onResize);
            resizeWatcher.observe(h1Edit);
            // Create the preview heading
            const previewEl = previewContent[0];
            const h1Preview = document.createElement("h1");
            applyRefStyles(h1Preview, this.previewSizerRef);
            h1Preview.setText(title);
            h1Preview.id = `${id}-preview`;
            h1Preview.classList.add('embedded-note-title', 'embedded-note-title__preview');
            previewEl.prepend(h1Preview);
            this.headings[id] = { leaf, resizeWatcher };
        }
    }
    // Generate a unique ID for a leaf
    getLeafId(leaf) {
        const viewState = leaf.getViewState();
        if (viewState.type === "markdown") {
            return "title-" + Math.random().toString(36).substr(2, 9);
        }
        return null;
    }
    // Iterate through all leafs and generate headings if needed
    createHeadings(app) {
        const seen = {};
        app.workspace.iterateRootLeaves((leaf) => {
            const id = this.getLeafId(leaf);
            if (id) {
                this.createHeading(id, leaf);
                seen[id] = true;
            }
        });
        Object.keys(this.headings).forEach((id) => {
            if (!seen[id]) {
                this.removeHeading(id);
            }
        });
    }
    cleanup() {
        this.previewSizerRef = null;
        this.codeMirrorSizerRef = null;
        Object.keys(this.headings).forEach((id) => {
            this.removeHeading(id);
        });
    }
}

class EmbeddedNoteTitlesPlugin extends obsidian.Plugin {
    onload() {
        document.body.classList.add("embedded-note-titles");
        this.headingsManager = new HeadingsManager();
        this.registerEvent(this.app.workspace.on("layout-change", () => {
            setTimeout(() => {
                this.headingsManager.createHeadings(this.app);
            }, 0);
        }));
        // Listen for CSS changes so we can recalculate heading styles
        this.registerEvent(this.app.workspace.on("css-change", () => {
            this.headingsManager.cleanup();
            setTimeout(() => {
                this.headingsManager.createHeadings(this.app);
            }, 0);
        }));
        this.app.workspace.layoutReady
            ? this.app.workspace.trigger("layout-change")
            : this.app.workspace.onLayoutReady(() => {
                // Trigger layout-change to ensure headings are created when the app loads
                this.app.workspace.trigger("layout-change");
            });
    }
    onunload() {
        document.body.classList.remove("embedded-note-titles");
        this.headingsManager.cleanup();
    }
}

module.exports = EmbeddedNoteTitlesPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsic3JjL2dldE1hdGNoZWRDU1NSdWxlcy50cyIsInNyYy9IZWFkaW5nc01hbmFnZXIudHMiLCJzcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBFTEVNRU5UX1JFID0gL1tcXHctXSsvZztcbmNvbnN0IElEX1JFID0gLyNbXFx3LV0rL2c7XG5jb25zdCBDTEFTU19SRSA9IC9cXC5bXFx3LV0rL2c7XG5jb25zdCBBVFRSX1JFID0gL1xcW1teXFxdXStcXF0vZztcbmNvbnN0IFBTRVVET19DTEFTU0VTX1JFID0gL1xcOig/IW5vdClbXFx3LV0rKFxcKC4qXFwpKT8vZztcbmNvbnN0IFBTRVVET19FTEVNRU5UU19SRSA9IC9cXDpcXDo/KGFmdGVyfGJlZm9yZXxmaXJzdC1sZXR0ZXJ8Zmlyc3QtbGluZXxzZWxlY3Rpb24pL2c7XG5cbi8vIGNvbnZlcnQgYW4gYXJyYXktbGlrZSBvYmplY3QgdG8gYXJyYXlcbmZ1bmN0aW9uIHRvQXJyYXkobGlzdDogYW55KSB7XG4gIHJldHVybiBbXS5zbGljZS5jYWxsKGxpc3QpO1xufVxuXG4vLyBoYW5kbGVzIGV4dHJhY3Rpb24gb2YgYGNzc1J1bGVzYCBhcyBhbiBgQXJyYXlgIGZyb20gYSBzdHlsZXNoZWV0IG9yIHNvbWV0aGluZyB0aGF0IGJlaGF2ZXMgdGhlIHNhbWVcbmZ1bmN0aW9uIGdldFNoZWV0UnVsZXMoc3R5bGVzaGVldDogQ1NTU3R5bGVTaGVldCkge1xuICB2YXIgc2hlZXRfbWVkaWEgPSBzdHlsZXNoZWV0Lm1lZGlhICYmIHN0eWxlc2hlZXQubWVkaWEubWVkaWFUZXh0O1xuICAvLyBpZiB0aGlzIHNoZWV0IGlzIGRpc2FibGVkIHNraXAgaXRcbiAgaWYgKHN0eWxlc2hlZXQuZGlzYWJsZWQpIHJldHVybiBbXTtcbiAgLy8gaWYgdGhpcyBzaGVldCdzIG1lZGlhIGlzIHNwZWNpZmllZCBhbmQgZG9lc24ndCBtYXRjaCB0aGUgdmlld3BvcnQgdGhlbiBza2lwIGl0XG4gIGlmIChcbiAgICBzaGVldF9tZWRpYSAmJlxuICAgIHNoZWV0X21lZGlhLmxlbmd0aCAmJlxuICAgICF3aW5kb3cubWF0Y2hNZWRpYShzaGVldF9tZWRpYSkubWF0Y2hlc1xuICApXG4gICAgcmV0dXJuIFtdO1xuICAvLyBnZXQgdGhlIHN0eWxlIHJ1bGVzIG9mIHRoaXMgc2hlZXRcbiAgcmV0dXJuIHRvQXJyYXkoc3R5bGVzaGVldC5jc3NSdWxlcyk7XG59XG5cbmZ1bmN0aW9uIF9maW5kKHN0cmluZzogc3RyaW5nLCByZTogUmVnRXhwKSB7XG4gIHZhciBtYXRjaGVzID0gc3RyaW5nLm1hdGNoKHJlKTtcbiAgcmV0dXJuIG1hdGNoZXMgPyBtYXRjaGVzLmxlbmd0aCA6IDA7XG59XG5cbi8vIGNhbGN1bGF0ZXMgdGhlIHNwZWNpZmljaXR5IG9mIGEgZ2l2ZW4gYHNlbGVjdG9yYFxuZnVuY3Rpb24gY2FsY3VsYXRlU2NvcmUoc2VsZWN0b3I6IHN0cmluZykge1xuICB2YXIgc2NvcmUgPSBbMCwgMCwgMF0sXG4gICAgcGFydHMgPSBzZWxlY3Rvci5zcGxpdChcIiBcIiksXG4gICAgcGFydCxcbiAgICBtYXRjaDtcbiAgLy9UT0RPOiBjbGVhbiB0aGUgJzpub3QnIHBhcnQgc2luY2UgdGhlIGxhc3QgRUxFTUVOVF9SRSB3aWxsIHBpY2sgaXQgdXBcbiAgd2hpbGUgKCgocGFydCA9IHBhcnRzLnNoaWZ0KCkpLCB0eXBlb2YgcGFydCA9PSBcInN0cmluZ1wiKSkge1xuICAgIC8vIGZpbmQgYWxsIHBzZXVkby1lbGVtZW50c1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgUFNFVURPX0VMRU1FTlRTX1JFKTtcbiAgICBzY29yZVsyXSArPSBtYXRjaDtcbiAgICAvLyBhbmQgcmVtb3ZlIHRoZW1cbiAgICBtYXRjaCAmJiAocGFydCA9IHBhcnQucmVwbGFjZShQU0VVRE9fRUxFTUVOVFNfUkUsIFwiXCIpKTtcbiAgICAvLyBmaW5kIGFsbCBwc2V1ZG8tY2xhc3Nlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgUFNFVURPX0NMQVNTRVNfUkUpO1xuICAgIHNjb3JlWzFdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKFBTRVVET19DTEFTU0VTX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgYXR0cmlidXRlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgQVRUUl9SRSk7XG4gICAgc2NvcmVbMV0gKz0gbWF0Y2g7XG4gICAgLy8gYW5kIHJlbW92ZSB0aGVtXG4gICAgbWF0Y2ggJiYgKHBhcnQgPSBwYXJ0LnJlcGxhY2UoQVRUUl9SRSwgXCJcIikpO1xuICAgIC8vIGZpbmQgYWxsIElEc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgSURfUkUpO1xuICAgIHNjb3JlWzBdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKElEX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgY2xhc3Nlc1xuICAgIG1hdGNoID0gX2ZpbmQocGFydCwgQ0xBU1NfUkUpO1xuICAgIHNjb3JlWzFdICs9IG1hdGNoO1xuICAgIC8vIGFuZCByZW1vdmUgdGhlbVxuICAgIG1hdGNoICYmIChwYXJ0ID0gcGFydC5yZXBsYWNlKENMQVNTX1JFLCBcIlwiKSk7XG4gICAgLy8gZmluZCBhbGwgZWxlbWVudHNcbiAgICBzY29yZVsyXSArPSBfZmluZChwYXJ0LCBFTEVNRU5UX1JFKTtcbiAgfVxuICByZXR1cm4gcGFyc2VJbnQoc2NvcmUuam9pbihcIlwiKSwgMTApO1xufVxuXG4vLyByZXR1cm5zIHRoZSBoZWlnaHRzIHBvc3NpYmxlIHNwZWNpZmljaXR5IHNjb3JlIGFuIGVsZW1lbnQgY2FuIGdldCBmcm9tIGEgZ2l2ZSBydWxlJ3Mgc2VsZWN0b3JUZXh0XG5mdW5jdGlvbiBnZXRTcGVjaWZpY2l0eVNjb3JlKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzZWxlY3RvclRleHQ6IHN0cmluZykge1xuICB2YXIgc2VsZWN0b3JzID0gc2VsZWN0b3JUZXh0LnNwbGl0KFwiLFwiKSxcbiAgICBzZWxlY3RvcixcbiAgICBzY29yZSxcbiAgICByZXN1bHQgPSAwO1xuXG4gIHdoaWxlICgoc2VsZWN0b3IgPSBzZWxlY3RvcnMuc2hpZnQoKSkpIHtcbiAgICBpZiAoZWxlbWVudC5tYXRjaGVzKHNlbGVjdG9yKSkge1xuICAgICAgc2NvcmUgPSBjYWxjdWxhdGVTY29yZShzZWxlY3Rvcik7XG4gICAgICByZXN1bHQgPSBzY29yZSA+IHJlc3VsdCA/IHNjb3JlIDogcmVzdWx0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHNvcnRCeVNwZWNpZmljaXR5KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBydWxlczogQ1NTU3R5bGVSdWxlW10pIHtcbiAgLy8gY29tcGFyaW5nIGZ1bmN0aW9uIHRoYXQgc29ydHMgQ1NTU3R5bGVSdWxlcyBhY2NvcmRpbmcgdG8gc3BlY2lmaWNpdHkgb2YgdGhlaXIgYHNlbGVjdG9yVGV4dGBcbiAgZnVuY3Rpb24gY29tcGFyZVNwZWNpZmljaXR5KGE6IENTU1N0eWxlUnVsZSwgYjogQ1NTU3R5bGVSdWxlKSB7XG4gICAgbGV0IGFTY29yZSA9IGdldFNwZWNpZmljaXR5U2NvcmUoZWxlbWVudCwgYS5zZWxlY3RvclRleHQpO1xuICAgIGxldCBiU2NvcmUgPSBnZXRTcGVjaWZpY2l0eVNjb3JlKGVsZW1lbnQsIGIuc2VsZWN0b3JUZXh0KTtcblxuICAgIC8vIElmIHRoZSBzdHlsZXMgY29tZSBmcm9tIGFwcC5jc3MsIHRoZXkgdGFrZSBhIGxvd2VyIHByaW9yaXR5XG4gICAgaWYgKGFTY29yZSA9PT0gYlNjb3JlKSB7XG4gICAgICBpZiAoYS5wYXJlbnRTdHlsZVNoZWV0LmhyZWYpIGFTY29yZSAtPSAxO1xuICAgICAgaWYgKGIucGFyZW50U3R5bGVTaGVldC5ocmVmKSBiU2NvcmUgLT0gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgYVNjb3JlIC1cbiAgICAgIGJTY29yZVxuICAgICk7XG4gIH1cblxuICByZXR1cm4gcnVsZXMuc29ydChjb21wYXJlU3BlY2lmaWNpdHkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWF0Y2hlZENTU1J1bGVzKGVsZW1lbnQ6IEhUTUxFbGVtZW50KTogQ1NTU3R5bGVSdWxlW10ge1xuICBsZXQgc3R5bGVTaGVldHMgPSB0b0FycmF5KHdpbmRvdy5kb2N1bWVudC5zdHlsZVNoZWV0cylcbiAgbGV0IHNoZWV0O1xuICBsZXQgcnVsZXM7XG4gIGxldCBydWxlO1xuICBsZXQgcmVzdWx0OiBDU1NTdHlsZVJ1bGVbXSA9IFtdO1xuXG4gIC8vIGFzc3VtaW5nIHRoZSBicm93c2VyIGhhbmRzIHVzIHN0eWxlc2hlZXRzIGluIG9yZGVyIG9mIGFwcGVhcmFuY2VcbiAgLy8gd2UgaXRlcmF0ZSB0aGVtIGZyb20gdGhlIGJlZ2lubmluZyB0byBmb2xsb3cgcHJvcGVyIGNhc2NhZGUgb3JkZXJcbiAgd2hpbGUgKChzaGVldCA9IHN0eWxlU2hlZXRzLnNoaWZ0KCkpKSB7XG4gICAgLy8gZ2V0IHRoZSBzdHlsZSBydWxlcyBvZiB0aGlzIHNoZWV0XG4gICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHNoZWV0KTtcbiAgICAvLyBsb29wIHRoZSBydWxlcyBpbiBvcmRlciBvZiBhcHBlYXJhbmNlXG4gICAgd2hpbGUgKChydWxlID0gcnVsZXMuc2hpZnQoKSkpIHtcbiAgICAgIC8vIGlmIHRoaXMgaXMgYW4gQGltcG9ydCBydWxlXG4gICAgICBpZiAocnVsZS5zdHlsZVNoZWV0KSB7XG4gICAgICAgIC8vIGluc2VydCB0aGUgaW1wb3J0ZWQgc3R5bGVzaGVldCdzIHJ1bGVzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzdHlsZXNoZWV0J3MgcnVsZXNcbiAgICAgICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHJ1bGUuc3R5bGVTaGVldCkuY29uY2F0KHJ1bGVzKTtcbiAgICAgICAgLy8gYW5kIHNraXAgdGhpcyBydWxlXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgLy8gaWYgdGhlcmUncyBubyBzdHlsZXNoZWV0IGF0dHJpYnV0ZSBCVVQgdGhlcmUgSVMgYSBtZWRpYSBhdHRyaWJ1dGUgaXQncyBhIG1lZGlhIHJ1bGVcbiAgICAgIGVsc2UgaWYgKHJ1bGUubWVkaWEpIHtcbiAgICAgICAgLy8gaW5zZXJ0IHRoZSBjb250YWluZWQgcnVsZXMgb2YgdGhpcyBtZWRpYSBydWxlIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhpcyBzdHlsZXNoZWV0J3MgcnVsZXNcbiAgICAgICAgcnVsZXMgPSBnZXRTaGVldFJ1bGVzKHJ1bGUpLmNvbmNhdChydWxlcyk7XG4gICAgICAgIC8vIGFuZCBza2lwIGl0XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBjaGVjayBpZiB0aGlzIGVsZW1lbnQgbWF0Y2hlcyB0aGlzIHJ1bGUncyBzZWxlY3RvclxuICAgICAgaWYgKGVsZW1lbnQubWF0Y2hlcyhydWxlLnNlbGVjdG9yVGV4dCkpIHtcbiAgICAgICAgLy8gcHVzaCB0aGUgcnVsZSB0byB0aGUgcmVzdWx0cyBzZXRcbiAgICAgICAgcmVzdWx0LnB1c2gocnVsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIHNvcnQgYWNjb3JkaW5nIHRvIHNwZWNpZmljaXR5XG4gIHJldHVybiBzb3J0QnlTcGVjaWZpY2l0eShlbGVtZW50LCByZXN1bHQpO1xufVxuIiwiaW1wb3J0IHsgQXBwLCBXb3Jrc3BhY2VMZWFmLCBkZWJvdW5jZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgZ2V0TWF0Y2hlZENTU1J1bGVzIH0gZnJvbSBcIi4vZ2V0TWF0Y2hlZENTU1J1bGVzXCI7XG5cbmludGVyZmFjZSBSZWZTaXppbmcge1xuICB3aWR0aD86IHN0cmluZztcbiAgbWF4V2lkdGg/OiBzdHJpbmc7XG4gIG1hcmdpbkxlZnQ/OiBzdHJpbmc7XG4gIG1hcmdpblJpZ2h0Pzogc3RyaW5nO1xuICBwYWRkaW5nTGVmdD86IHN0cmluZztcbiAgcGFkZGluZ1JpZ2h0Pzogc3RyaW5nO1xufVxuXG4vLyBTcGxpdCBDU1MgbWFyZ2luIGFuZCBwYWRkaW5nIHZhbHVlcyBsaWtlIGAwIGF1dG9gLCBgMTBweCBhdXRvIDBgLCBldGMuXG5mdW5jdGlvbiBnZXRSaWdodExlZnQodmFsOiBzdHJpbmcpIHtcbiAgaWYgKC9cXHMvLnRlc3QodmFsKSkge1xuICAgIGNvbnN0IHZhbHMgPSB2YWwuc3BsaXQoL1xccysvZyk7XG5cbiAgICBpZiAodmFscy5sZW5ndGggPT09IDIgfHwgdmFscy5sZW5ndGggPT09IDMpIHtcbiAgICAgIHJldHVybiBbdmFsc1sxXSwgdmFsc1sxXV07XG4gICAgfVxuXG4gICAgaWYgKHZhbHMubGVuZ3RoID09PSA0KSB7XG4gICAgICByZXR1cm4gW3ZhbHNbMV0sIHZhbHNbM11dO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBbdmFsLCB2YWxdO1xufVxuXG5jb25zdCBrZXlNYXA6IHsgW2s6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICB3aWR0aDogXCJ3aWR0aFwiLFxuICBtYXhXaWR0aDogXCJtYXgtd2lkdGhcIixcbiAgbWFyZ2luOiBcIm1hcmdpblwiLFxuICBtYXJnaW5MZWZ0OiBcIm1hcmdpbi1sZWZ0XCIsXG4gIG1hcmdpblJpZ2h0OiBcIm1hcmdpbi1yaWdodFwiLFxuICBwYWRkaW5nOiBcInBhZGRpbmdcIixcbiAgcGFkZGluZ0xlZnQ6IFwicGFkZGluZy1sZWZ0XCIsXG4gIHBhZGRpbmdSaWdodDogXCJwYWRkaW5nLXJpZ2h0XCIsXG59O1xuXG4vLyBHZXQgdGhlIHJlbGV2YW50IHN0eWxlIHZhbHVlcyBmcm9tIGEgcmVmZXJlbmNlIGVsZW1lbnRcbmZ1bmN0aW9uIGdldFJlZlNpemluZyhlbDogSFRNTEVsZW1lbnQpIHtcbiAgY29uc3QgcnVsZXMgPSBnZXRNYXRjaGVkQ1NTUnVsZXMoZWwpO1xuICBjb25zdCBzaXppbmc6IFJlZlNpemluZyA9IHt9O1xuXG4gIHJ1bGVzLmZvckVhY2goKHIpID0+IHtcbiAgICBjb25zdCB7XG4gICAgICB3aWR0aCxcbiAgICAgIG1heFdpZHRoLFxuICAgICAgbWFyZ2luLFxuICAgICAgbWFyZ2luTGVmdCxcbiAgICAgIG1hcmdpblJpZ2h0LFxuICAgICAgcGFkZGluZyxcbiAgICAgIHBhZGRpbmdMZWZ0LFxuICAgICAgcGFkZGluZ1JpZ2h0LFxuICAgIH0gPSByLnN0eWxlO1xuXG4gICAgaWYgKHdpZHRoKSB7XG4gICAgICBzaXppbmcud2lkdGggPSB3aWR0aDtcbiAgICB9XG5cbiAgICBpZiAobWF4V2lkdGgpIHtcbiAgICAgIHNpemluZy5tYXhXaWR0aCA9IG1heFdpZHRoO1xuICAgIH1cblxuICAgIGlmIChtYXJnaW4pIHtcbiAgICAgIGNvbnN0IFttUmlnaHQsIG1MZWZ0XSA9IGdldFJpZ2h0TGVmdChtYXJnaW4pO1xuICAgICAgc2l6aW5nLm1hcmdpbkxlZnQgPSBtTGVmdDtcbiAgICAgIHNpemluZy5tYXJnaW5MZWZ0ID0gbVJpZ2h0O1xuICAgIH1cblxuICAgIGlmIChtYXJnaW5MZWZ0KSBzaXppbmcubWFyZ2luTGVmdCA9IG1hcmdpbkxlZnQ7XG4gICAgaWYgKG1hcmdpblJpZ2h0KSBzaXppbmcubWFyZ2luUmlnaHQgPSBtYXJnaW5SaWdodDtcblxuICAgIGlmIChwYWRkaW5nKSB7XG4gICAgICBjb25zdCBbcFJpZ2h0LCBwTGVmdF0gPSBnZXRSaWdodExlZnQocGFkZGluZyk7XG4gICAgICBzaXppbmcucGFkZGluZ0xlZnQgPSBwTGVmdDtcbiAgICAgIHNpemluZy5wYWRkaW5nTGVmdCA9IHBSaWdodDtcbiAgICB9XG5cbiAgICBpZiAocGFkZGluZ0xlZnQpIHNpemluZy5wYWRkaW5nTGVmdCA9IHBhZGRpbmdMZWZ0O1xuICAgIGlmIChwYWRkaW5nUmlnaHQpIHNpemluZy5wYWRkaW5nUmlnaHQgPSBwYWRkaW5nUmlnaHQ7XG4gIH0pO1xuXG4gIHJldHVybiBzaXppbmc7XG59XG5cbi8vIEFwcGx5IHJlZmVyZW5jZSBzdHlsZXMgdG8gYSBoZWFkaW5nIGVsZW1lbnRcbmZ1bmN0aW9uIGFwcGx5UmVmU3R5bGVzKGhlYWRpbmc6IEhUTUxFbGVtZW50LCByZWY6IFJlZlNpemluZykge1xuICBmb3IgKGNvbnN0IGtleSBpbiByZWYpIHtcbiAgICBjb25zdCB2YWwgPSByZWZba2V5IGFzIGtleW9mIFJlZlNpemluZ107XG5cbiAgICBpZiAodmFsKSB7XG4gICAgICBoZWFkaW5nLnN0eWxlLnNldFByb3BlcnR5KGtleU1hcFtrZXldLCB2YWwpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSGVhZGluZ3NNYW5hZ2VyIHtcbiAgaGVhZGluZ3M6IHtcbiAgICBbaWQ6IHN0cmluZ106IHtcbiAgICAgIGxlYWY6IFdvcmtzcGFjZUxlYWY7XG4gICAgICByZXNpemVXYXRjaGVyOiBSZXNpemVPYnNlcnZlcjtcbiAgICB9O1xuICB9ID0ge307XG5cbiAgcHJldmlld1NpemVyUmVmOiBSZWZTaXppbmcgfCBudWxsID0gbnVsbDtcbiAgY29kZU1pcnJvclNpemVyUmVmOiBSZWZTaXppbmcgfCBudWxsID0gbnVsbDtcbiAgY29kZU1pcnJvclNpemVySW52YWxpZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgZ2V0UHJldmlld1NpemVyU3R5bGVzKCkge1xuICAgIGNvbnN0IGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcIm1hcmtkb3duLXByZXZpZXctc2l6ZXJcIik7XG5cbiAgICBpZiAoZWwubGVuZ3RoKSB7XG4gICAgICB0aGlzLnByZXZpZXdTaXplclJlZiA9IGdldFJlZlNpemluZyhlbFswXSBhcyBIVE1MRWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0Q29kZU1pcnJvclNpemVyU3R5bGVzKCkge1xuICAgIGNvbnN0IHNpemVyRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvci1zaXplclwiKTtcbiAgICBjb25zdCBsaW5lRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvci1saW5lXCIpO1xuXG4gICAgaWYgKHNpemVyRWwubGVuZ3RoICYmIGxpbmVFbC5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHNpemVyID0gc2l6ZXJFbFswXSBhcyBIVE1MRWxlbWVudDtcblxuICAgICAgY29uc3QgeyBtYXJnaW5MZWZ0LCBwYWRkaW5nUmlnaHQsIGJvcmRlclJpZ2h0V2lkdGggfSA9IHNpemVyLnN0eWxlO1xuXG4gICAgICAvLyBJZiBjb2RlbWlycm9yIGhhc24ndCBhcHBsaWVkIHN0eWxlcyB0byB0aGUgZGl2IHlldCwgbGV0J3MgY29uc2lkZXIgaXRcbiAgICAgIC8vIGludmFsaWQgc28gd2UgY2FuIGNoZWNrIGl0IGFnYWluIGxhdGVyXG4gICAgICBpZiAobWFyZ2luTGVmdCAhPT0gXCIwcHhcIiAmJiBwYWRkaW5nUmlnaHQgIT09IFwiMHB4XCIpIHtcbiAgICAgICAgdGhpcy5jb2RlTWlycm9yU2l6ZXJJbnZhbGlkID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlubGluZTogUmVmU2l6aW5nID0ge1xuICAgICAgICBtYXJnaW5MZWZ0LFxuICAgICAgICBtYXJnaW5SaWdodDogYm9yZGVyUmlnaHRXaWR0aCxcbiAgICAgICAgcGFkZGluZ1JpZ2h0LFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc2l6ZXJSZWYgPSBnZXRSZWZTaXppbmcoc2l6ZXIpO1xuXG4gICAgICBjb25zdCBsaW5lID0gbGluZUVsWzBdIGFzIEhUTUxFbGVtZW50O1xuICAgICAgY29uc3QgbGluZVJlZiA9IGdldFJlZlNpemluZyhsaW5lKTtcblxuICAgICAgLy8gQ29tYmluZSBpbmxpbmUgc3R5bGVzIHdpdGggQ1NTIHN0eWxlc1xuICAgICAgdGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYgPSB7XG4gICAgICAgIC4uLmlubGluZSxcbiAgICAgICAgLi4uc2l6ZXJSZWYsXG4gICAgICB9O1xuXG4gICAgICBpZiAobGluZVJlZi5wYWRkaW5nTGVmdCkge1xuICAgICAgICB0aGlzLmNvZGVNaXJyb3JTaXplclJlZi5wYWRkaW5nTGVmdCA9IHRoaXMuY29kZU1pcnJvclNpemVyUmVmXG4gICAgICAgICAgLnBhZGRpbmdMZWZ0XG4gICAgICAgICAgPyBgY2FsYygke3RoaXMuY29kZU1pcnJvclNpemVyUmVmLnBhZGRpbmdMZWZ0fSArICR7bGluZVJlZi5wYWRkaW5nTGVmdH0pYFxuICAgICAgICAgIDogbGluZVJlZi5wYWRkaW5nTGVmdDtcbiAgICAgIH1cblxuICAgICAgaWYgKGxpbmVSZWYucGFkZGluZ1JpZ2h0KSB7XG4gICAgICAgIHRoaXMuY29kZU1pcnJvclNpemVyUmVmLnBhZGRpbmdSaWdodCA9IHRoaXMuY29kZU1pcnJvclNpemVyUmVmXG4gICAgICAgICAgLnBhZGRpbmdSaWdodFxuICAgICAgICAgID8gYGNhbGMoJHt0aGlzLmNvZGVNaXJyb3JTaXplclJlZi5wYWRkaW5nUmlnaHR9ICsgJHtsaW5lUmVmLnBhZGRpbmdSaWdodH0pYFxuICAgICAgICAgIDogbGluZVJlZi5wYWRkaW5nUmlnaHQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gT25jZSB0aGUgY29kZW1pcnJvciBoZWFkaW5nIHN0eWxlcyBoYXZlIGJlZW4gdmFsaWRhdGVkLCBsb29wIHRocm91Z2ggYW5kIHVwZGF0ZSBldmVyeXRoaW5nXG4gIHVwZGF0ZUNvZGVNaXJyb3JIZWFkaW5ncygpIHtcbiAgICBPYmplY3Qua2V5cyh0aGlzLmhlYWRpbmdzKS5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgY29uc3QgaDFFZGl0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7aWR9LWVkaXRgKTtcbiAgICAgIGFwcGx5UmVmU3R5bGVzKGgxRWRpdCwgdGhpcy5jb2RlTWlycm9yU2l6ZXJSZWYpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQ2xlYW4gdXAgaGVhZGluZ3Mgb25jZSBhIHBhbmUgaGFzIGJlZW4gY2xvc2VkIG9yIHRoZSBwbHVnaW4gaGFzIGJlZW4gZGlzYWJsZWRcbiAgcmVtb3ZlSGVhZGluZyhpZDogc3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzLmhlYWRpbmdzW2lkXSkgcmV0dXJuO1xuXG4gICAgY29uc3QgaDFFZGl0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7aWR9LWVkaXRgKTtcbiAgICBjb25zdCBoMVByZXZpZXcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtpZH0tcHJldmlld2ApO1xuXG4gICAgaWYgKGgxRWRpdCkgaDFFZGl0LnJlbW92ZSgpO1xuICAgIGlmIChoMVByZXZpZXcpIGgxUHJldmlldy5yZW1vdmUoKTtcblxuICAgIHRoaXMuaGVhZGluZ3NbaWRdLnJlc2l6ZVdhdGNoZXIuZGlzY29ubmVjdCgpO1xuXG4gICAgZGVsZXRlIHRoaXMuaGVhZGluZ3NbaWRdLnJlc2l6ZVdhdGNoZXI7XG4gICAgZGVsZXRlIHRoaXMuaGVhZGluZ3NbaWRdO1xuICB9XG5cbiAgY3JlYXRlSGVhZGluZyhpZDogc3RyaW5nLCBsZWFmOiBXb3Jrc3BhY2VMZWFmKSB7XG4gICAgLy8gQ29kZU1pcnJvciBhZGRzIG1hcmdpbiBhbmQgcGFkZGluZyBvbmx5IGFmdGVyIHRoZSBlZGl0b3IgaXMgdmlzaWJsZVxuICAgIGlmIChcbiAgICAgIHRoaXMuY29kZU1pcnJvclNpemVySW52YWxpZCAmJlxuICAgICAgbGVhZi5nZXRWaWV3U3RhdGUoKS5zdGF0ZT8ubW9kZSA9PT0gXCJzb3VyY2VcIlxuICAgICkge1xuICAgICAgdGhpcy5nZXRDb2RlTWlycm9yU2l6ZXJTdHlsZXMoKTtcblxuICAgICAgaWYgKCF0aGlzLmNvZGVNaXJyb3JTaXplckludmFsaWQpIHtcbiAgICAgICAgdGhpcy51cGRhdGVDb2RlTWlycm9ySGVhZGluZ3MoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5oZWFkaW5nc1tpZF0pIHJldHVybjtcblxuICAgIGNvbnN0IHRpdGxlID0gKGxlYWYudmlldyBhcyBhbnkpLmZpbGU/LmJhc2VuYW1lO1xuXG4gICAgaWYgKCF0aXRsZSkgcmV0dXJuO1xuXG4gICAgY29uc3Qgdmlld0NvbnRlbnQgPVxuICAgICAgbGVhZi52aWV3LmNvbnRhaW5lckVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJDb2RlTWlycm9yLXNjcm9sbFwiKTtcblxuICAgIGNvbnN0IGxpbmVzID1cbiAgICAgIGxlYWYudmlldy5jb250YWluZXJFbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiQ29kZU1pcnJvci1saW5lc1wiKTtcblxuICAgIGNvbnN0IHByZXZpZXdDb250ZW50ID0gbGVhZi52aWV3LmNvbnRhaW5lckVsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXG4gICAgICBcIm1hcmtkb3duLXByZXZpZXctdmlld1wiXG4gICAgKTtcblxuICAgIGlmICghdGhpcy5wcmV2aWV3U2l6ZXJSZWYpIHtcbiAgICAgIHRoaXMuZ2V0UHJldmlld1NpemVyU3R5bGVzKCk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvZGVNaXJyb3JTaXplclJlZikge1xuICAgICAgdGhpcy5nZXRDb2RlTWlycm9yU2l6ZXJTdHlsZXMoKTtcbiAgICB9XG5cbiAgICBpZiAodmlld0NvbnRlbnQubGVuZ3RoICYmIHByZXZpZXdDb250ZW50Lmxlbmd0aCkge1xuICAgICAgLy8gQ3JlYXRlIHRoZSBjb2RlbWlycm9yIGhlYWRpbmdcbiAgICAgIGNvbnN0IGVkaXRFbCA9IHZpZXdDb250ZW50WzBdIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgY29uc3QgaDFFZGl0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xuXG4gICAgICBhcHBseVJlZlN0eWxlcyhoMUVkaXQsIHRoaXMuY29kZU1pcnJvclNpemVyUmVmKTtcblxuICAgICAgaDFFZGl0LnNldFRleHQodGl0bGUpO1xuICAgICAgaDFFZGl0LmlkID0gYCR7aWR9LWVkaXRgO1xuICAgICAgaDFFZGl0LmNsYXNzTGlzdC5hZGQoJ2VtYmVkZGVkLW5vdGUtdGl0bGUnLCAnZW1iZWRkZWQtbm90ZS10aXRsZV9fZWRpdCcpXG4gICAgICBlZGl0RWwucHJlcGVuZChoMUVkaXQpO1xuXG4gICAgICBjb25zdCBvblJlc2l6ZSA9IGRlYm91bmNlKFxuICAgICAgICAoZW50cmllczogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKGxpbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgbGluZXNFbCA9IGxpbmVzWzBdIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgICAgICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5jZWlsKGVudHJpZXNbMF0uYm9yZGVyQm94U2l6ZVswXS5ibG9ja1NpemUpO1xuXG4gICAgICAgICAgICBsaW5lc0VsLnN0eWxlLnBhZGRpbmdUb3AgPSBgJHtoZWlnaHR9cHhgO1xuICAgICAgICAgICAgaDFFZGl0LnN0eWxlLm1hcmdpbkJvdHRvbSA9IGAtJHtoZWlnaHR9cHhgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgMjAsXG4gICAgICAgIHRydWVcbiAgICAgICk7XG5cbiAgICAgIC8vIFdlIG5lZWQgdG8gcHVzaCB0aGUgY29udGVudCBkb3duIHdoZW4gdGhlIHBhbmUgcmVzaXplcyBzbyB0aGUgaGVhZGluZ1xuICAgICAgLy8gZG9lc24ndCBjb3ZlciB0aGUgY29udGVudFxuICAgICAgY29uc3QgcmVzaXplV2F0Y2hlciA9IG5ldyAod2luZG93IGFzIGFueSkuUmVzaXplT2JzZXJ2ZXIob25SZXNpemUpO1xuXG4gICAgICByZXNpemVXYXRjaGVyLm9ic2VydmUoaDFFZGl0KTtcblxuICAgICAgLy8gQ3JlYXRlIHRoZSBwcmV2aWV3IGhlYWRpbmdcbiAgICAgIGNvbnN0IHByZXZpZXdFbCA9IHByZXZpZXdDb250ZW50WzBdIGFzIEhUTUxEaXZFbGVtZW50O1xuICAgICAgY29uc3QgaDFQcmV2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xuXG4gICAgICBhcHBseVJlZlN0eWxlcyhoMVByZXZpZXcsIHRoaXMucHJldmlld1NpemVyUmVmKTtcblxuICAgICAgaDFQcmV2aWV3LnNldFRleHQodGl0bGUpO1xuICAgICAgaDFQcmV2aWV3LmlkID0gYCR7aWR9LXByZXZpZXdgO1xuICAgICAgaDFQcmV2aWV3LmNsYXNzTGlzdC5hZGQoJ2VtYmVkZGVkLW5vdGUtdGl0bGUnLCAnZW1iZWRkZWQtbm90ZS10aXRsZV9fcHJldmlldycpXG4gICAgICBwcmV2aWV3RWwucHJlcGVuZChoMVByZXZpZXcpO1xuXG4gICAgICB0aGlzLmhlYWRpbmdzW2lkXSA9IHsgbGVhZiwgcmVzaXplV2F0Y2hlciB9O1xuICAgIH1cbiAgfVxuXG4gIC8vIEdlbmVyYXRlIGEgdW5pcXVlIElEIGZvciBhIGxlYWZcbiAgZ2V0TGVhZklkKGxlYWY6IFdvcmtzcGFjZUxlYWYpIHtcbiAgICBjb25zdCB2aWV3U3RhdGUgPSBsZWFmLmdldFZpZXdTdGF0ZSgpO1xuXG4gICAgaWYgKHZpZXdTdGF0ZS50eXBlID09PSBcIm1hcmtkb3duXCIpIHtcbiAgICAgIHJldHVybiBcInRpdGxlLVwiICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpO1xuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLy8gSXRlcmF0ZSB0aHJvdWdoIGFsbCBsZWFmcyBhbmQgZ2VuZXJhdGUgaGVhZGluZ3MgaWYgbmVlZGVkXG4gIGNyZWF0ZUhlYWRpbmdzKGFwcDogQXBwKSB7XG4gICAgY29uc3Qgc2VlbjogeyBbazogc3RyaW5nXTogYm9vbGVhbiB9ID0ge307XG5cbiAgICBhcHAud29ya3NwYWNlLml0ZXJhdGVSb290TGVhdmVzKChsZWFmKSA9PiB7XG4gICAgICBjb25zdCBpZCA9IHRoaXMuZ2V0TGVhZklkKGxlYWYpO1xuXG4gICAgICBpZiAoaWQpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVIZWFkaW5nKGlkLCBsZWFmKTtcbiAgICAgICAgc2VlbltpZF0gPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmtleXModGhpcy5oZWFkaW5ncykuZm9yRWFjaCgoaWQpID0+IHtcbiAgICAgIGlmICghc2VlbltpZF0pIHtcbiAgICAgICAgdGhpcy5yZW1vdmVIZWFkaW5nKGlkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGNsZWFudXAoKSB7XG4gICAgdGhpcy5wcmV2aWV3U2l6ZXJSZWYgPSBudWxsO1xuICAgIHRoaXMuY29kZU1pcnJvclNpemVyUmVmID0gbnVsbDtcblxuICAgIE9iamVjdC5rZXlzKHRoaXMuaGVhZGluZ3MpLmZvckVhY2goKGlkKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUhlYWRpbmcoaWQpO1xuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBQbHVnaW4gfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IHsgSGVhZGluZ3NNYW5hZ2VyIH0gZnJvbSBcIi4vSGVhZGluZ3NNYW5hZ2VyXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBFbWJlZGRlZE5vdGVUaXRsZXNQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIGhlYWRpbmdzTWFuYWdlcjogSGVhZGluZ3NNYW5hZ2VyO1xyXG5cclxuICBvbmxvYWQoKSB7XHJcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoXCJlbWJlZGRlZC1ub3RlLXRpdGxlc1wiKTtcclxuICAgIHRoaXMuaGVhZGluZ3NNYW5hZ2VyID0gbmV3IEhlYWRpbmdzTWFuYWdlcigpO1xyXG5cclxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcclxuICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uKFwibGF5b3V0LWNoYW5nZVwiLCAoKSA9PiB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmhlYWRpbmdzTWFuYWdlci5jcmVhdGVIZWFkaW5ncyh0aGlzLmFwcCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIC8vIExpc3RlbiBmb3IgQ1NTIGNoYW5nZXMgc28gd2UgY2FuIHJlY2FsY3VsYXRlIGhlYWRpbmcgc3R5bGVzXHJcbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXHJcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImNzcy1jaGFuZ2VcIiwgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuaGVhZGluZ3NNYW5hZ2VyLmNsZWFudXAoKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICB0aGlzLmhlYWRpbmdzTWFuYWdlci5jcmVhdGVIZWFkaW5ncyh0aGlzLmFwcCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICAgIH0pXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5sYXlvdXRSZWFkeVxyXG4gICAgICA/IHRoaXMuYXBwLndvcmtzcGFjZS50cmlnZ2VyKFwibGF5b3V0LWNoYW5nZVwiKVxyXG4gICAgICA6IHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KCgpID0+IHtcclxuICAgICAgICAgIC8vIFRyaWdnZXIgbGF5b3V0LWNoYW5nZSB0byBlbnN1cmUgaGVhZGluZ3MgYXJlIGNyZWF0ZWQgd2hlbiB0aGUgYXBwIGxvYWRzXHJcbiAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UudHJpZ2dlcihcImxheW91dC1jaGFuZ2VcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgfVxyXG5cclxuICBvbnVubG9hZCgpIHtcclxuICAgIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZShcImVtYmVkZGVkLW5vdGUtdGl0bGVzXCIpO1xyXG4gICAgdGhpcy5oZWFkaW5nc01hbmFnZXIuY2xlYW51cCgpO1xyXG4gIH1cclxufVxyXG4iXSwibmFtZXMiOlsiZGVib3VuY2UiLCJQbHVnaW4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLE1BQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQztBQUM3QixNQUFNLEtBQUssR0FBRyxVQUFVLENBQUM7QUFDekIsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDO0FBQzdCLE1BQU0sT0FBTyxHQUFHLGFB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
